{"version":3,"sources":["../../../src/panels/nav-panel/module.js"],"names":["dark","light","EndpointNavCtrl","$scope","$injector","$location","$q","backendSrv","templateSrv","alertSrv","contextSrv","datasourceSrv","endpointSlugs","ctrl","panel","title","transparent","pageReady","statuses","label","value","endpoints","endpointState","datasourceUpgrader","DatasourceUpgrader","values","_","forEach","variables","tmplVar","name","current","isArray","getEndpointSlugs","getEndpoints","self","get","then","resp","meta","code","set","message","reject","isGoogleDemo","length","body","endpoint","indexOf","slug","push","type","check","checks","c","toLowerCase","enabled","state","states","duration","Date","getTime","stateChange","secs","Math","floor","mins","hours","days","search","path","id","PanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport '../../filters/all';\nimport '../../directives/all';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\nimport DatasourceUpgrader from '../../components/config/dsUpgrade';\nimport { promiseToDigest } from '../../utils/promiseToDigest';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass EndpointNavCtrl extends PanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, templateSrv, alertSrv, contextSrv, datasourceSrv) {\n    super($scope, $injector);\n    this.$location = $location;\n    this.$q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.datasourceSrv = datasourceSrv;\n    this.alertSrv = alertSrv;\n    this.endpointSlugs = [];\n\n    $scope.ctrl.panel.title = \"\";\n    $scope.ctrl.panel.transparent = true;\n\n    this.pageReady = false;\n    this.statuses = [\n      {label: \"Ok\", value: 0},\n      {label: \"Warning\", value: 1},\n      {label: \"Error\", value: 2},\n      {label: \"Unknown\", value: -1},\n    ];\n    this.endpoints = [];\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n    this.datasourceUpgrader = new DatasourceUpgrader(contextSrv, backendSrv, $q, datasourceSrv);\n  }\n\n  getEndpointSlugs() {\n    var values = null;\n    _.forEach(this.templateSrv.variables, function(tmplVar) {\n      if (tmplVar.name === 'endpoint') {\n        values = tmplVar.current.value;\n        if (!_.isArray(values)) {\n          values = [values];\n        }\n        values;\n      }\n    });\n    this.endpointSlugs = values;\n    return values;\n  }\n\n  refresh() {\n    var endpointSlugs = this.getEndpointSlugs();\n    this.getEndpoints(endpointSlugs);\n  }\n\n  getEndpoints(endpointSlugs) {\n    var self = this;\n    promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints').then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint list.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoints = [];\n      self.isGoogleDemo = endpointSlugs.length === 1 && endpointSlugs[0] === '~google_com_demo';\n      _.forEach(resp.body, function(endpoint) {\n        if (_.indexOf(endpointSlugs, endpoint.slug) >= 0) {\n          self.endpoints.push(endpoint);\n        }\n      });\n      self.pageReady = true;\n    }));\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!check.enabled) {\n      return \"disabled\";\n    }\n    if (check.state < 0 || check.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[check.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"\";\n    }\n    var duration = new Date().getTime() - new Date(check.stateChange).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-collector\": \"All\",\n      \"var-endpoint\": endpoint.slug\n    };\n    switch(type) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.path('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  }\n}\n\nEndpointNavCtrl.templateUrl = 'public/plugins/raintank-worldping-app/panels/nav-panel/module.html';\nexport {\n  EndpointNavCtrl as PanelCtrl\n};\n"],"file":"module.js"}