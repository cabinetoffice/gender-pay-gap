{"version":3,"sources":["../../../src/panels/endpoint-list/module.js"],"names":["dark","light","EndpointListCtrl","$scope","$injector","$location","$q","backendSrv","contextSrv","alertSrv","isOrgEditor","hasRole","pageReady","statuses","label","value","filter","sort_field","endpoints","refresh","endpointState","icon","addEditorTab","editorTabIndex","getEndpoints","map","_","forEach","endpoint","tags","tag","Object","keys","status","actual","expected","equal","self","get","then","resp","meta","code","set","message","reject","body","type","check","checks","c","toLowerCase","enabled","state","states","duration","Date","getTime","stateChange","secs","Math","floor","mins","hours","days","path","search","slug","url","id","PanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["import '../../filters/all';\nimport '../../directives/all';\nimport _ from 'lodash';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\nimport { promiseToDigest } from '../../utils/promiseToDigest';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass EndpointListCtrl extends PanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, contextSrv, alertSrv) {\n    super($scope, $injector);\n    this.isOrgEditor = contextSrv.hasRole('Editor') || contextSrv.hasRole('Admin');\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$q = $q;\n    this.pageReady = false;\n    this.statuses = [\n      {label: \"Ok\", value: 0},\n      {label: \"Warning\", value: 1},\n      {label: \"Error\", value: 2},\n      {label: \"Unknown\", value: -1},\n    ];\n    this.filter = {'tag': '', 'status': ''};\n    this.sort_field = 'name';\n    this.endpoints = [];\n    this.refresh();\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n  }\n\n  initEditMode() {\n    super.initEditMode();\n    this.icon = 'fa fa-text-width';\n    this.addEditorTab('Options', 'public/plugins/raintank-worldping-app/panels/endpoint-list/editor.html');\n    this.editorTabIndex = 1;\n  }\n\n  refresh() {\n    this.getEndpoints();\n  }\n\n  endpointTags() {\n    var map = {};\n    _.forEach(this.endpoints, function(endpoint) {\n      _.forEach(endpoint.tags, function(tag) {\n        map[tag] = true;\n      });\n    });\n    return Object.keys(map);\n  }\n\n  setTagFilter(tag) {\n    this.filter.tag = tag;\n  }\n\n  setStatusFilter(status) {\n    if (status === this.filter.status) {\n      status = \"\";\n    }\n    this.filter.status = status;\n  }\n\n  statusFilter(actual, expected) {\n    if (expected === \"\" || expected === null) {\n      return true;\n    }\n    var equal = (actual === expected);\n    return equal;\n  }\n\n  getEndpoints() {\n    const self = this;\n    promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint list.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoints = resp.body;\n      self.pageReady = true;\n    }));\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!check.enabled) {\n      return \"disabled\";\n    }\n    if (check.state < 0 || check.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[check.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"\";\n    }\n\n    var duration = new Date().getTime() - new Date(check.stateChange).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint) {\n    this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search({\"var-collector\": \"All\", \"var-endpoint\": endpoint.slug});\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.url('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  }\n}\n\nEndpointListCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_list.html';\n\nexport {\n  EndpointListCtrl as PanelCtrl\n};\n"],"file":"module.js"}