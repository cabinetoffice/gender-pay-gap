{"version":3,"sources":["../../src/directives/all.js"],"names":["angular","module","directive","templateUrl","scope","ctrl","endpoint","$compile","datasourceSrv","timeSrv","check","link","init","time","from","frequency","to","metricsQuery","range","timeRange","rangeRaw","interval","targets","target","slug","type","toLowerCase","format","maxDataPoints","datasource","get","then","ds","query","results","showHealth","data","metrics","okCount","errorCount","unknownCount","collectorResults","_","forEach","result","parts","split","stateStr","collector","ts","state","i","datapoints","length","point","isNaN","console","log","col","unknowns","getProbesForCheck","Object","keys","eventReady","$window","$timeout","probes","model","elem","bodyEl","element","document","body","selectedIds","selectedTags","route","config","ids","footprint","value","tags","error","reset","seenTags","sortedProbes","sortBy","o","name","c","option","id","selected","text","indexOf","sort","t","push","show","selectorOpen","giveFocus","on","bodyOnClick","idSelected","selectAll","select","map","filter","tagSelected","probesWithTags","probeList","join","probeCount","tag","count","selectTagTitle","slice","selectIdTitle","routeTypeChange","hide","off","e","dropdown","find","has","$apply","$watch"],"mappings":"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","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive(\"rtEndpointHealthDashboard\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealthDashboard.html',\n    scope: {\n      ctrl: \"=\",\n      endpoint: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtCheckHealth\", function($compile, datasourceSrv, timeSrv) {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/checkHealth.html',\n    scope: {\n      check: \"=\",\n      ctrl: \"=\"\n    },\n    link: function(scope) {\n      timeSrv.init({\n        time: {from: \"now-\"+(scope.check.frequency + 30)+ 's', to: \"now\"}\n      });\n      var metricsQuery = {\n        range: timeSrv.timeRange(),\n        rangeRaw: timeSrv.timeRange(true),\n        interval: scope.check.frequency + 's',\n        targets: [\n          {target: \"worldping.\"+scope.ctrl.endpoint.slug + \".*.\" +\n            scope.check.type.toLowerCase()+\".{ok_state,error_state}\"}\n        ],\n        format: 'json',\n        maxDataPoints: 10,\n      };\n\n      var datasource = datasourceSrv.get('raintank');\n      datasource.then(function(ds) {\n        ds.query(metricsQuery).then(function(results) {\n          showHealth(results);\n        }, function() {\n          showHealth({data: []});\n        });\n      });\n\n      function showHealth(metrics) {\n        var okCount = 0;\n        var errorCount = 0;\n        var unknownCount = 0;\n        var collectorResults = {};\n        _.forEach(metrics.data, function(result) {\n          var parts = result.target.split('.');\n          var stateStr = parts[4];\n          var collector = parts[2];\n          if (!(collector in collectorResults)) {\n            collectorResults[collector] = {ts: -1, state: -1};\n          }\n\n          //start with the last point and work backwards till we find a non-null value.\n          for (var i = result.datapoints.length - 1 ; i >= 0; i--) {\n            var point = result.datapoints[i];\n            if (!isNaN(point[0])) {\n              if ((point[0] === 1) && (point[1] > collectorResults[collector].ts)) {\n                collectorResults[collector].ts = point[1];\n                switch (stateStr) {\n                  case 'ok_state':\n                    collectorResults[collector].state = 0;\n                    break;\n                  case 'error_state':\n                    collectorResults[collector].state = 2;\n                    break;\n                  default:\n                    collectorResults[collector].state = -1;\n                    console.log(\"unknown state returned. this shouldnt happen :(\");\n                }\n                break;\n              }\n            }\n          }\n        });\n        for (var col in collectorResults) {\n          switch (collectorResults[col].state) {\n            case 0:\n              okCount++;\n              break;\n            case 2:\n              errorCount++;\n              break;\n            default:\n              unknownCount++;\n          }\n        }\n        var unknowns = scope.ctrl.getProbesForCheck(scope.check.type).length - Object.keys(collectorResults).length;\n        unknownCount += unknowns;\n\n        scope.okCount = okCount;\n        scope.errorCount = errorCount;\n        scope.unknownCount = unknownCount;\n        scope.eventReady = true;\n      }\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtEndpointHealth\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealth.html',\n    scope: {\n      endpoint: \"=\",\n      ctrl: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive('endpointProbeSelect', function($compile, $window, $timeout) {\n  return {\n    scope: {\n      probes: \"=\",\n      model: \"=\",\n    },\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointCollectorSelect.html',\n    link: function(scope, elem) {\n      var bodyEl = angular.element($window.document.body);\n      var selectedIds = [];\n      var selectedTags = [];\n\n      scope.init = function() {\n        if (scope.model.route.type === 'byIds') {\n          selectedIds = scope.model.route.config.ids;\n          scope.footprint = {value: \"static\"};\n        } else {\n          selectedTags = scope.model.route.config.tags;\n          scope.footprint = {value: \"dynamic\"};\n        }\n        scope.error = false;\n\n        scope.reset();\n      };\n\n      scope.reset = function() {\n        scope.error = false;\n        scope.ids = [];\n        scope.tags = [];\n        //build out our list of collectorIds and tags\n        var seenTags = {};\n        var sortedProbes = _.sortBy(scope.probes, function(o) {\n          return o.name.toLowerCase();\n        });\n        _.forEach(sortedProbes, function(c) {\n          var option = {id: c.id, selected: false, text: c.name};\n          if (_.indexOf(selectedIds, c.id) >= 0) {\n            option.selected = true;\n          }\n          _.forEach(c.tags.sort(), function(t) {\n            if (!(t in seenTags)) {\n              seenTags[t] = true;\n              var o = {selected: false, text: t};\n              if (_.indexOf(selectedTags, t) >= 0) {\n                o.selected = true;\n              }\n              scope.tags.push(o);\n            }\n          });\n          scope.ids.push(option);\n        });\n        if (scope.footprint.value === 'dynamic') {\n          _.forEach(scope.ids, function(i) {\n            i.selected = false;\n          });\n        } else {\n          _.forEach(scope.tags, function(t) {\n            t.selected = false;\n          });\n        }\n      };\n\n      scope.show = function() {\n        scope.reset();\n        scope.selectorOpen = true;\n        scope.giveFocus = 1;\n\n        $timeout(function() {\n          bodyEl.on('click', scope.bodyOnClick);\n        }, 0, false);\n      };\n\n      scope.idSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.selectAll = function() {\n        var select = true;\n        selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n\n        if (selectedIds.length === scope.ids.length) {\n          select = false;\n        }\n        _.forEach(scope.ids, function(option) {\n          option.selected = select;\n        });\n      };\n\n      scope.tagSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.probesWithTags = function() {\n        var probeList = {};\n        _.forEach(scope.probes, function(c) {\n          _.forEach(_.filter(scope.tags, {selected: true}), function(t) {\n            if (_.indexOf(c.tags, t.text) !== -1) {\n              probeList[c.name] = true;\n            }\n          });\n        });\n        return Object.keys(probeList).join(', ');\n      };\n\n      scope.probeCount = function(tag) {\n        var count = 0;\n        _.forEach(scope.probes, function(c) {\n          if (_.indexOf(c.tags, tag.text) !== -1) {\n            count++;\n          }\n        });\n        return count;\n      };\n\n      scope.selectTagTitle = function() {\n        selectedTags = _.map(_.filter(scope.tags, {selected: true}), \"text\");\n        if (selectedTags.length === 0) {\n          return \"Select Tags\";\n        }\n        if (selectedTags.length <= 2) {\n          return selectedTags.join(\", \");\n        }\n        return selectedTags.slice(0, 2).join(\", \") + \" and \" + (selectedTags.length - 2) + \" more\";\n      };\n\n      scope.selectIdTitle = function() {\n        selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n        if (selectedIds.length === 0) {\n          return \"Select Probes\";\n        }\n        if (selectedIds.length <= 2) {\n          return _.map(_.filter(scope.ids, {selected: true}), \"text\").join(\", \");\n        }\n        return _.map(_.filter(scope.ids, {selected: true}), \"text\").slice(0, 2).join(\", \") + \" and \" + (selectedIds.length - 2) + \" more\";\n      };\n\n      scope.routeTypeChange = function() {\n        if (scope.footprint.value === 'dynamic') {\n          selectedTags = _.map(_.filter(scope.tags, {selected: true}), \"text\");\n          scope.model.route = {\n            type: \"byTags\",\n            config: {\n              tags: []\n            }\n          };\n          _.forEach(selectedTags, function(t) {\n            scope.model.route.config.tags.push(t.text);\n          });\n        } else {\n          selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n          scope.model.route = {\n            type: \"byIds\",\n            config: {\n              ids: []\n            }\n          };\n          _.forEach(selectedIds, function(c) {\n            scope.model.route.config.ids.push(c.id);\n          });\n        }\n      };\n\n      scope.hide = function() {\n        if (scope.footprint.value === 'dynamic') {\n          scope.model.route = {\n            type: \"byTags\",\n            config: {\n              tags: []\n            }\n          };\n          selectedTags = _.map(_.filter(scope.tags, {selected: true}), \"text\");\n          _.forEach(selectedTags, function(t) {\n            scope.model.route.config.tags.push(t);\n          });\n        } else {\n          scope.model.route = {\n            type: \"byIds\",\n            config: {\n              ids: []\n            }\n          };\n          selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n          _.forEach(selectedIds, function(c) {\n            scope.model.route.config.ids.push(c);\n          });\n        }\n        scope.selectorOpen = false;\n        bodyEl.off('click', scope.bodyOnClick);\n      };\n\n      scope.bodyOnClick = function(e) {\n        var dropdown = elem.find('.variable-value-dropdown');\n        if (dropdown.has(e.target).length === 0) {\n          scope.$apply(scope.hide);\n        }\n      };\n\n      scope.$watch('model.id', function() {\n        scope.init();\n      });\n    },\n  };\n});\n"],"file":"all.js"}