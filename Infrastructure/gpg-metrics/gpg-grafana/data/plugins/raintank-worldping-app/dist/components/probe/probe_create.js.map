{"version":3,"sources":["../../../src/components/probe/probe_create.js"],"names":["defaults","name","enabled","ProbeCreateCtrl","$scope","$injector","$location","$window","$q","backendSrv","alertSrv","self","newProbe","installMethod","deb","rpm","docker","manual","probe","angular","copy","org","requiresUpgrade","search","getProbe","reset","getOrgDetails","newMethod","_","forEach","method","console","log","id","get","then","resp","meta","code","set","message","reject","body","p","_requiresUpgrade","statusText","wpPlan","ignoreChanges","history","back","put","post","newCollector","showConfigInfo","showDistroConfig","templateUrl"],"mappings":"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","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\nimport { promiseToDigest } from '../../utils/promiseToDigest';\n\nvar defaults = {\n  name: '',\n  enabled: true,\n};\n\nclass ProbeCreateCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $window, $q, backendSrv, alertSrv) {\n    var self = this;\n    this.$window = $window;\n    this.$q = $q;\n    this.$scope = $scope;\n    this.alertSrv = alertSrv;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.newProbe = false;\n    this.installMethod = {\n      deb: false,\n      rpm: false,\n      docker: false,\n      manual: false,\n    };\n    this.probe = angular.copy(defaults);\n    this.org = null;\n    this.requiresUpgrade = null;\n\n    if (\"probe\" in $location.search()) {\n      self.getProbe($location.search().probe);\n    } else {\n      self.reset();\n    }\n\n    self.getOrgDetails();\n  }\n\n  setInstallMethod(newMethod) {\n    var self = this;\n    _.forEach(this.installMethod, function(enabled, method) {\n      if (method === newMethod) {\n        self.installMethod[method] = true;\n      } else {\n        self.installMethod[method] = false;\n      }\n    });\n    console.log(this.installMethod);\n  }\n\n  getProbe(id) {\n    var self = this;\n    return promiseToDigest(this.$scope)\n      (this.backendSrv.get(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes/\"+id).then((resp) => {\n        if (resp.meta.code !== 200) {\n          self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n          return self.$q.reject(resp.meta.message);\n        }\n        self.probe = resp.body;\n      })\n    );\n  }\n\n  getOrgDetails() {\n    var self = this;\n    var p = promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org'));\n    p.then((resp) => {\n      self.org = resp;\n      self.requiresUpgrade = self._requiresUpgrade();\n    }, (resp) => {\n      self.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n    });\n    return p;\n  }\n\n  _requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free') {\n      return false;\n    }\n\n    return true;\n  }\n\n  reset() {\n    this.probe = angular.copy(defaults);\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  save() {\n    var self = this;\n    return promiseToDigest(this.$scope)\n      (this.backendSrv.put(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n        if (resp.meta.code !== 200) {\n          self.alertSrv.set(\"failed to save probe.\", resp.meta.message, 'error', 10000);\n          return self.$q.reject(resp.meta.message);\n        }\n      })\n    );\n  }\n\n  add() {\n    var self = this;\n    return promiseToDigest(this.$scope)\n      (this.backendSrv.post(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n        if (resp.meta.code !== 200) {\n          self.alertSrv.set(\"failed to add probe.\", resp.meta.message, 'error', 10000);\n          return self.$q.reject(resp.meta.message);\n        }\n        self.newCollector = true;\n        self.probe = resp.body;\n      })\n    );\n  }\n\n  configInfo() {\n    this.showConfigInfo = true;\n  }\n\n  defaultDistro() {\n    this.showDistroConfig = false;\n  }\n\n  otherDistro() {\n    this.showDistroConfig = true;\n  }\n}\n\nProbeCreateCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/probe/partials/probe_create.html';\nexport {\n  ProbeCreateCtrl\n};\n"],"file":"probe_create.js"}