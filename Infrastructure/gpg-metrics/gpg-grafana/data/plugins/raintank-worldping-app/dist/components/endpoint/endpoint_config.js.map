{"version":3,"sources":["../../../src/components/endpoint/endpoint_config.js"],"names":["_defaultCheck","settings","healthSettings","notifications","num_collectors","steps","route","type","config","defaultCheck","checkType","check","_","cloneDeep","timeout","port","path","headers","body","method","host","downloadLimit","expectRegex","frequency","validateCert","hostname","name","protocol","server","EndpointConfigCtrl","$scope","$injector","$rootScope","$location","$modal","$anchorScroll","$timeout","$window","$q","backendSrv","alertSrv","self","pageReady","showCreating","insufficientQuota","frequencyOpts","freqOpt","forEach","f","push","value","label","newEndpointName","checks","endpoint","probes","probesByTag","org","quotas","ignoreChanges","promises","reset","search","getEndpoint","getQuotas","checkQuota","getProbes","getOrgDetails","all","then","err","set","showPing","showDNS","showHTTP","showHTTPS","onbeforeunload","changesPending","$on","event","next","preventDefault","baseLen","absUrl","length","url","console","log","nextUrl","substring","modalScope","$new","ignore","save","savePending","appEvent","src","modalClass","scope","idString","id","parseInt","get","resp","meta","code","message","reject","definedChecks","keys","indexOf","q","target","limit","used","probe","tags","t","statusText","getProbesForCheck","ids","probeList","p","undefined","reduce","total","enabled","totalChecks","probeCount","size","toFixed","wpPlan","checksPerMonth","discovered","discoveryInProgress","discoveryError","showConfig","history","back","saveEndpoint","i","put","numProbes","num_collector","found","c","delay","newChecks","post","slug","endpointReadyDelay","endpointReady","changes","seenCheckTypes","angular","equals","templateUrl"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport angular from 'angular';\nimport { promiseToDigest } from '../../utils/promiseToDigest';\n\nvar _defaultCheck = {\n  settings: {},\n  healthSettings: {\n    notifications: {},\n    num_collectors: 3,\n    steps: 3\n  },\n  route: {\n    type: \"byIds\",\n    config: {\n      \"ids\": []\n    }\n  }\n};\n\nfunction defaultCheck(checkType) {\n  var check = _.cloneDeep(_defaultCheck);\n  switch (checkType) {\n    case \"http\":\n      check.type = \"http\";\n      check.settings = {\n        timeout: 5,\n        port: 80,\n        path: \"/\",\n        headers: \"User-Agent: worldping-api\\nAccept-Encoding: gzip\\n\",\n        body: '',\n        method: \"GET\",\n        host: \"\",\n        downloadLimit: '',\n        expectRegex: \"\"\n      };\n      check.frequency = 120;\n      break;\n    case \"https\":\n      check.type = \"https\";\n      check.settings = {\n        timeout: 5,\n        port: 443,\n        path: \"/\",\n        headers: \"User-Agent: worldping-api\\nAccept-Encoding: gzip\\n\",\n        body: '',\n        method: \"GET\",\n        host: \"\",\n        validateCert: true,\n        downloadLimit: '',\n        expectRegex: \"\"\n      };\n      check.frequency = 120;\n      break;\n    case \"ping\":\n      check.type = \"ping\";\n      check.settings = {\n        timeout: 5,\n        hostname: \"\"\n      };\n      check.frequency = 60;\n      break;\n    case \"dns\":\n      check.type = \"dns\";\n      check.settings = {\n        timeout: 5,\n        name: \"\",\n        port: 53,\n        protocol: \"udp\",\n        server: \"\",\n        type: \"A\",\n        expectRegex: \"\",\n      };\n      check.frequency = 120;\n      break;\n  }\n  return check;\n}\n\nclass EndpointConfigCtrl {\n  /** @ngInject */\n  constructor($scope, $injector, $rootScope, $location, $modal, $anchorScroll, $timeout, $window, $q, backendSrv, alertSrv) {\n    var self = this;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.alertSrv = alertSrv;\n    this.$window = $window;\n    this.$scope = $scope;\n\n    this.pageReady = false;\n    this.showCreating = false;\n    this.insufficientQuota = false;\n\n    this.frequencyOpts = [];\n    var freqOpt = [10, 30, 60, 120];\n    _.forEach(freqOpt, f => {\n      this.frequencyOpts.push({value: f, label: \"Every \"+f+\"s\"});\n    });\n\n    this.newEndpointName = \"\";\n    this.checks = {};\n    this.endpoint = {};\n    this.probes = [];\n    this.probesByTag = {};\n    this.org = null;\n    this.quotas = {};\n\n    this.ignoreChanges = false;\n\n    var promises = [];\n    this.reset();\n    if (\"endpoint\" in $location.search()) {\n      promises.push(this.getEndpoint($location.search().endpoint));\n      promises.push(this.getQuotas());\n    } else {\n      // make sure we have sufficient quota.\n      promises.push(this.checkQuota());\n      this.endpoint = {name: \"\"};\n    }\n\n    promises.push(this.getProbes());\n    promises.push(this.getOrgDetails());\n\n    $q.all(promises).then(() => {\n      this.pageReady = true;\n      $timeout(function() {\n        $anchorScroll();\n      }, 0, false);\n    }, function(err) {\n      alertSrv.set(\"endpoint config init failed\", err, 'error', 10000);\n    });\n\n    if ($location.search().check) {\n      switch($location.search().check) {\n        case \"ping\":\n          this.showPing = true;\n          break;\n        case \"dns\":\n          this.showDNS = true;\n          break;\n        case \"http\":\n          this.showHTTP = true;\n          break;\n        case \"https\":\n          this.showHTTPS = true;\n          break;\n      }\n    }\n\n    $window.onbeforeunload = function() {\n      if (self.ignoreChanges) { return; }\n      if (self.changesPending()) {\n        return \"There are unsaved changes to this dashboard\";\n      }\n    };\n\n    $scope.$on('$locationChangeStart', function(event, next) {\n      if ((!self.ignoreChanges) && (self.changesPending())) {\n        event.preventDefault();\n        var baseLen = $location.absUrl().length - $location.url().length;\n        console.log(\"next: \", next);\n        console.log(\"baseLen: \", baseLen);\n        var nextUrl = next.substring(baseLen);\n        console.log(\"nexUrl: \", nextUrl);\n        var modalScope = $scope.$new();\n        modalScope.ignore = function() {\n          self.ignoreChanges = true;\n          $location.url(nextUrl);\n          return;\n        };\n\n        modalScope.save = function() {\n          self.savePending(nextUrl);\n        };\n\n        $rootScope.appEvent('show-modal', {\n          src: 'public/app/partials/unsaved-changes.html',\n          modalClass: 'confirm-modal',\n          scope: modalScope,\n        });\n      }\n    });\n  }\n\n  getEndpoint(idString) {\n    var id = parseInt(idString);\n    return promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/'+id).then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to get endpoint.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.endpoint = resp.body;\n      this.newEndpointName = this.endpoint.name;\n      _.forEach(resp.body.checks, check => {\n        this.checks[check.type] = _.cloneDeep(check);\n      });\n      var definedChecks = _.keys(this.checks);\n      if (definedChecks.length < 4) {\n        if (_.indexOf(definedChecks, \"http\") === -1) {\n          this.checks[\"http\"] = defaultCheck(\"http\");\n        }\n        if (_.indexOf(definedChecks, \"https\") === -1) {\n          this.checks[\"https\"] = defaultCheck(\"https\");\n        }\n        if (_.indexOf(definedChecks, \"ping\") === -1) {\n          this.checks[\"ping\"] = defaultCheck(\"ping\");\n        }\n        if (_.indexOf(definedChecks, \"dns\") === -1) {\n          this.checks[\"dns\"] = defaultCheck(\"dns\");\n        }\n      }\n    }));\n  }\n\n  getQuotas() {\n    return promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/quotas').then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to get quotas.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      _.forEach(resp.body, q => {\n        this.quotas[q.target] = q;\n      });\n      return this.quotas;\n    }));\n  }\n\n  checkQuota() {\n    return this.getQuotas().then(quotas => {\n      if (quotas.endpoint) {\n        const q = quotas.endpoint;\n        this.insufficientQuota = q.limit > 0 && q.used >= q.limit;\n      }\n      if (this.insufficientQuota) {\n        return this.$q.reject(\"Endpoint quota reached.\");\n      }\n      return true;\n    });\n  }\n\n  getProbes() {\n    return promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes').then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to get getProbes.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.probes = resp.body;\n      _.forEach(this.probes, probe => {\n        _.forEach(probe.tags, t => {\n          if (!(t in this.probesByTag)) {\n            this.probesByTag[t] = [];\n          }\n          this.probesByTag[t].push(probe);\n        });\n      });\n    }));\n  }\n\n  getOrgDetails() {\n    return promiseToDigest(this.$scope)(this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org').then(\n      resp => {\n        this.org = resp;\n      },\n      resp => {\n        this.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n      }\n    ));\n  }\n\n  probeCount(check) {\n    if (!check) {\n      return 0;\n    }\n    return this.getProbesForCheck(check).length;\n  }\n\n  getProbesForCheck(check) {\n    if (check.route.type === \"byIds\") {\n      return check.route.config.ids || [];\n    }\n\n    if (check.route.type === \"byTags\") {\n      var probeList = {};\n      _.forEach(this.probes, p => {\n        _.forEach(check.route.config.tags, t => {\n          if (_.indexOf(p.tags, t) !== -1) {\n            probeList[p.id] = true;\n          }\n        });\n      });\n      return _.keys(probeList);\n    }\n\n    this.alertSrv(\"check has unknown routing type.\", \"unknown route type.\", \"error\", 5000);\n    return [];\n  }\n\n  totalChecks(check) {\n    if (check === undefined) {\n      return _.reduce(this.checks, (total, value) => {\n        if (!value.enabled) {\n          return total;\n        }\n\n        return total + this.totalChecks(value);\n      }, 0);\n    }\n\n    var probeCount = this.probeCount(check);\n    if (probeCount < 1 || check.frequency < 1) {\n      return 0;\n    }\n\n    return (30.4375 * 24 * (3600/check.frequency) * probeCount / 1000000);\n  }\n\n  formatSize(size) {\n    if (size > 1024 * 1024) {\n      return (size / 1024 / 1024).toFixed(2) + ' MB';\n    }\n    if (size > 1024) {\n      return (size / 1024).toFixed(2) + ' KB';\n    }\n    return size;\n  }\n\n  currentlyTrial() {\n    if (!this.org) {\n      return false;\n    }\n\n    if (this.org.wpPlan === 'trial') {\n      return true;\n    }\n\n    return false;\n  }\n\n  requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free' && this.org.wpPlan !== 'trial') {\n      return false;\n    }\n\n    if (this.org.checksPerMonth / 1000000 + this.totalChecks() > 1) {\n      return true;\n    }\n\n    return false;\n  }\n\n  reset() {\n    this.discovered = false;\n    this.discoveryInProgress = false;\n    this.discoveryError = false;\n    this.showConfig = false;\n    this.showCreating = false;\n    this.endpoint = {};\n    this.checks = {};\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  remove(endpoint) {\n    return promiseToDigest(this.$scope)\n      (this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/' + endpoint.id).then(resp => {\n        if (resp.meta.code !== 200) {\n          this.alertSrv.set(\"failed to delete endpoint.\", resp.meta.message, 'error', 10000);\n          return this.$q.reject(resp.meta.message);\n        }\n        this.$location.path('plugins/raintank-worldping-app/page/endpoints');\n      })\n    );\n  }\n\n  updateEndpoint() {\n    this.endpoint.name = this.newEndpointName;\n    this.saveEndpoint();\n  }\n\n  tagsUpdated() {\n    this.saveEndpoint();\n  }\n\n  savePending(nextUrl) {\n    _.forEach(this.checks, check => {\n      if (!check.id && check.enabled) {\n        //add the check\n        this.endpoint.checks.push(check);\n        return;\n      }\n      for (var i=0; i < this.endpoint.checks.length; i++) {\n        if (this.endpoint.checks[i].id === check.id) {\n          this.endpoint.checks[i] = _.cloneDeep(check);\n        }\n      }\n    });\n    return this.saveEndpoint().then(() => {\n      this.ignoreChanges = true;\n      if (nextUrl) {\n        this.$location.url(nextUrl);\n      } else {\n        this.$location.path(\"plugins/raintank-worldping-app/page/endpoints\");\n      }\n    });\n  }\n\n  saveEndpoint() {\n    return promiseToDigest(this.$scope)\n    (this.backendSrv.put('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints', this.endpoint).then(resp => {\n        if (resp.meta.code !== 200) {\n          this.alertSrv.set(\"failed to update endpoint.\", resp.meta.message, 'error', 10000);\n          return this.$q.reject(resp.meta.message);\n        }\n        this.endpoint = resp.body;\n      })\n    );\n  }\n\n  updateCheck(check) {\n    if (check.enabled) {\n      var numProbes = this.probeCount(check);\n      if (numProbes < check.healthSettings.num_collector) {\n        check.healthSettings.num_collectors = numProbes;\n      }\n      if (check.type === \"http\" || check.type === \"https\") {\n        if (['PUT', 'POST', 'DELETE', 'PATCH'].indexOf(check.settings.method) < 0) {\n          check.settings.body = \"\";\n        }\n      }\n    }\n    var found = false;\n    for (var i=0; i < this.endpoint.checks.length; i++) {\n      if (this.endpoint.checks[i].type === check.type) {\n        this.endpoint.checks[i] = _.cloneDeep(check);\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      this.endpoint.checks.push(check);\n    }\n    return this.saveEndpoint().then(() => {\n      this.alertSrv.set(check.type + \" check updated.\", \"\", \"success\", 2000);\n      _.forEach(this.endpoint.checks, c => {\n        if (c.type === check.type) {\n          this.checks[check.type] = _.cloneDeep(c);\n        }\n      });\n    });\n  }\n\n  skipDiscovery() {\n    this.discoveryInProgress = false;\n    this.showConfig = true;\n    this.discoveryError = false;\n  }\n\n  discover(endpoint) {\n    if (!endpoint.name){\n      return;\n    }\n    this.discoveryInProgress = true;\n    this.discoveryError = false;\n    return promiseToDigest(this.$scope)\n      (this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/discover', endpoint).then(\n        resp => {\n          if (resp.meta.code !== 200) {\n            this.alertSrv.set(\"failed to update endpoint.\", resp.meta.message, 'error', 10000);\n            this.discoveryError = \"Failed to discover endpoint.\";\n            return this.$q.reject(resp.meta.message);\n          }\n          this.endpoint = resp.body;\n          _.forEach(this.endpoint.checks, check => {\n            this.checks[check.type] = _.cloneDeep(check);\n          });\n          var definedChecks = _.keys(this.checks);\n          if (definedChecks.length < 4) {\n            if (_.indexOf(definedChecks, \"http\") === -1) {\n              this.checks[\"http\"] = defaultCheck(\"http\");\n            }\n            if (_.indexOf(definedChecks, \"https\") === -1) {\n              this.checks[\"https\"] = defaultCheck(\"https\");\n            }\n            if (_.indexOf(definedChecks, \"ping\") === -1) {\n              this.checks[\"ping\"] =defaultCheck(\"ping\");\n            }\n            if (_.indexOf(definedChecks, \"dns\") === -1) {\n              this.checks[\"dns\"] = defaultCheck(\"dns\");\n            }\n          }\n          this.showConfig = true;\n          this.discovered = true;\n        },\n        () => {\n          this.discoveryError = \"Failed to discover endpoint.\";\n        }\n      ).finally(() => {\n        this.discoveryInProgress = false;\n      })\n    );\n  }\n\n  addEndpoint() {\n    var self = this;\n    var delay = 120;\n    var newChecks = [];\n    _.forEach(this.checks, check => {\n      if (check.enabled) {\n        if (check.frequency < delay) {\n          delay = check.frequency;\n        }\n        var numProbes = this.probeCount(check);\n        if (numProbes < 3) {\n          check.healthSettings.num_collectors = numProbes;\n        }\n        newChecks.push(check);\n      }\n    });\n    this.endpoint.checks = newChecks;\n    return promiseToDigest(this.$scope)\n      (this.backendSrv.post('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints', this.endpoint).then(resp => {\n        if (resp.meta.code !== 200) {\n          this.alertSrv.set(\"failed to add endpoint.\", resp.meta.message, 'error', 10000);\n          return this.$q.reject(resp.meta.message);\n        }\n        this.endpoint.id = resp.body.id;\n        this.endpoint.slug = resp.body.slug;\n        this.ignoreChanges = true;\n        this.alertSrv.set(\"endpoint added\", '', 'success', 3000);\n        this.showCreating = true;\n        this.endpointReadyDelay = delay;\n        this.endpointReady = false;\n        this.$timeout(function() {\n          self.endpointReady = true;\n        }, delay * 1000);\n      })\n    );\n  }\n\n  changesPending() {\n    var changes = false;\n    var seenCheckTypes = {};\n\n    //check if any existing checks have changed\n    _.forEach(this.endpoint.checks, check => {\n      seenCheckTypes[check.type] = true;\n      if (!angular.equals(check, this.checks[check.type])) {\n        changes = true;\n      }\n    });\n\n    //check if any new checks added.\n    _.forEach(this.checks, check => {\n      if (!(check.type in seenCheckTypes) && (\"frequency\" in check) && check.enabled) {\n        changes = true;\n      }\n    });\n\n    return changes;\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-collector\": \"All\",\n      \"var-endpoint\": this.endpoint.slug\n    };\n    switch(type) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n}\n\nEndpointConfigCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_config.html';\n\nexport {EndpointConfigCtrl};\n"],"file":"endpoint_config.js"}